<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Escolher Números</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="detalhes-rifa"></div>
  <div id="numeros-container" class="grid-numeros"></div>

  <div class="form">
    <input type="text" id="nome" placeholder="Seu nome">
    <input type="tel" id="whatsapp" placeholder="WhatsApp">
    <button onclick="reservar()">Reservar Selecionados</button>
    <div id="msg"></div>
  </div>

  <script src="api.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const rifaId = urlParams.get("id");
    let numerosSelecionados = [];

    async function carregarRifa() {
      const { rifa, numeros } = await getNumerosPorRifa(rifaId);
      document.getElementById("detalhes-rifa").innerHTML = `
        <h1>${rifa.nome}</h1>
        <p>Valor por número: R$ ${rifa.valor}</p>
        <p>Prêmios:</p>
        <ul>${rifa.premios.map(p => `<li>${p}</li>`).join("")}</ul>
      `;

      const container = document.getElementById("numeros-container");
      numeros.forEach(num => {
        const btn = document.createElement("button");
        btn.textContent = num.numero;
        btn.disabled = num.status !== "disponível";
        btn.className = num.status === "disponível" ? "livre" : "reservado";
        btn.onclick = () => {
          btn.classList.toggle("selecionado");
          if (numerosSelecionados.includes(num.numero)) {
            numerosSelecionados = numerosSelecionados.filter(n => n !== num.numero);
          } else {
            numerosSelecionados.push(num.numero);
          }
        };
        container.appendChild(btn);
      });
    }

    async function reservar() {
      const nome = document.getElementById("nome").value;
      const whatsapp = document.getElementById("whatsapp").value;
      const msg = document.getElementById("msg");

      if (!nome || !whatsapp || numerosSelecionados.length === 0) {
        msg.textContent = "Preencha todos os campos e selecione pelo menos um número.";
        return;
      }

      const resposta = await reservarNumeros(rifaId, numerosSelecionados, nome, whatsapp);
      msg.textContent = resposta;
    }

    carregarRifa();
  </script>
</body>
</html>
